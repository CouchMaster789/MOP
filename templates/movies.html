{% extends "base.html" %}

{% block main_content %}
    <div class="float-end">
        <div class="card bg-info text-center mb-1 p-1 d-inline-block" style="width: 7em;">
            <b id="sources_count">Loading Source Count</b>
        </div>

        <div class="card bg-warning text-center d-inline-block mb-1 p-1" style="width: 7em;">
            <b id="movie_count">Loading Movie Count</b>
        </div>
    </div>

    <table class="table table-sm table-bordered border-primary" id="movie_list">
        <thead>
        <tr>
            <th>Name</th>
            <th>Year</th>
            <th>Source</th>
            <th>Resolution</th>
            <th>Edition</th>
            <th>Codec</th>
        </tr>
        </thead>
        <tbody id="body"></tbody>
    </table>
{% endblock main_content %}

{% block extra_js %}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let table = document.querySelector("#movie_list");

            fetch("{{ url_for("movies.movies") }}", {
                method: "POST"
            })
                .then(response => response.json())
                .then(function (data) {
                    console.log(data);

                    document.querySelector("#sources_count").innerText = data["source_count"] + " Sources"
                    document.querySelector("#movie_count").innerText = data["movie_count"] + " Movies"

                    if (data["movie_count"] === 0)
                        table.querySelector("#body").insertAdjacentHTML("beforeend", `<tr><td colspan=4 class="text-center fst-italic">No results available</td></tr>`);

                    data["movies"].forEach(function (movie) {
                        table.querySelector("#body").insertAdjacentHTML("beforeend", `
                        <tr>
                            <td>
                                ${movie["marked"]["title"]}
                                <small class="text-muted">${movie["filename"]}</small>
                                <br>
                                <small class="text-muted">${movie["path"]}</small>
                            </td>
                            <td>${movie["marked"]["year"]}</td>
                            <td>${movie["marked"]["source"]}</td>
                            <td>${movie["marked"]["resolution"]}</td>
                            <td>${movie["marked"]["edition"]}</td>
                            <td>${movie["marked"]["codec"]}</td>
                        </tr>
                        `)
                    })
                });
        });
    </script>
{% endblock extra_js %}