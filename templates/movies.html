{% extends "base.html" %}

{% block main_content %}
    <h1 class="text-center my-3">MOP Movies</h1>

    <div class="row d-flex flex-column auto-scroll h-100">

        <div class="col-5 d-flex flex-column auto-scroll">
            <div class="row justify-content-around mb-2 ms-0">
                <div class="col">
                    <div class="card bg-darkest text-white text-center mb-1 p-1 d-inline-block" style="width: 5em;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                             class="bi bi-diagram-3-fill mb-1" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                  d="M6 3.5A1.5 1.5 0 0 1 7.5 2h1A1.5 1.5 0 0 1 10 3.5v1A1.5 1.5 0 0 1 8.5 6v1H14a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0V8h-5v.5a.5.5 0 0 1-1 0v-1A.5.5 0 0 1 2 7h5.5V6A1.5 1.5 0 0 1 6 4.5v-1zm-6 8A1.5 1.5 0 0 1 1.5 10h1A1.5 1.5 0 0 1 4 11.5v1A1.5 1.5 0 0 1 2.5 14h-1A1.5 1.5 0 0 1 0 12.5v-1zm6 0A1.5 1.5 0 0 1 7.5 10h1a1.5 1.5 0 0 1 1.5 1.5v1A1.5 1.5 0 0 1 8.5 14h-1A1.5 1.5 0 0 1 6 12.5v-1zm6 0a1.5 1.5 0 0 1 1.5-1.5h1a1.5 1.5 0 0 1 1.5 1.5v1a1.5 1.5 0 0 1-1.5 1.5h-1a1.5 1.5 0 0 1-1.5-1.5v-1z"></path>
                        </svg>
                        <b id="sources_count">loading</b>
                    </div>

                    <div class="card bg-light text-dark text-center d-inline-block mb-1 p-1"
                         style="width: 5em;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                             class="bi bi-film mb-1" viewBox="0 0 16 16">
                            <path d="M0 1a1 1 0 0 1 1-1h14a1 1 0 0 1 1 1v14a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V1zm4 0v6h8V1H4zm8 8H4v6h8V9zM1 1v2h2V1H1zm2 3H1v2h2V4zM1 7v2h2V7H1zm2 3H1v2h2v-2zm-2 3v2h2v-2H1zM15 1h-2v2h2V1zm-2 3v2h2V4h-2zm2 3h-2v2h2V7zm-2 3v2h2v-2h-2zm2 3h-2v2h2v-2z"></path>
                        </svg>

                        <b class="" id="movie_count">loading</b>
                    </div>
                </div>

                <div class="col-auto text-end">
                    <form class="d-flex pt-1" style="max-width: 20em;">
                        <button type="button" class="btn btn-secondary text-dark me-2 pb-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                                 class="bi bi-filter-circle-fill" viewBox="0 0 16 16">
                                <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zM3.5 5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1 0-1zM5 8.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5zm2 3a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 0 1h-1a.5.5 0 0 1-.5-.5z"></path>
                            </svg>
                        </button>
                        <input class="form-control form-control-sm me-2" type="search" placeholder="Search"
                               aria-label="Search">
                        <button class="btn btn-sm btn-outline-success" type="submit">Search</button>
                    </form>
                </div>
            </div>

            <hr class="mt-0 mb-1">

            <div class="auto-scroll">
                <table class="table text-white mt-2 h-100" id="movie_list">
                    <tbody id="body"></tbody>
                </table>
            </div>
        </div>

        <div class="col-7 auto-scroll">
            <div class="card bg-darkest">
                <div class="card-header">
                    <div class="row">
                        <div class="col">
                            <h3 class="float-start mb-0">The Shawshank Redemption</h3>
                            <small class="text-white-50 fw-bold ms-3" style="line-height: 3em;">1994</small>
                            <small class="text-white-50 fw-bold ms-2" style="line-height: 3em;">2 hours 20
                                minutes</small>
                        </div>
                        <div class="col text-end">
                            <b style="line-height: 2.5em;">8.7</b>
                            <small class="text-muted">17956</small>
                        </div>
                    </div>
                </div>

                <div class="card-body text-white-50">
                    <div class="row">
                        <div class="col">
                            <div class="text-justify"> {# TMDB Data #}
                                Framed in the 1940s for the double murder of his wife and her lover, upstanding
                                banker
                                Andy Dufresne begins a new life at the Shawshank prison, where he puts his
                                accounting
                                skills to work for an amoral warden. During his long stretch in prison, Dufresne
                                comes
                                to be admired by the other inmates -- including an older prisoner named Red -- for
                                his
                                integrity and unquenchable sense of hope.
                            </div>

                            <hr>

                            <div class="bg-dark p-2">
                                <h5 class="text-white">
                                    Marked Data
                                </h5>

                                <label class="fw-bold" style="width: 9em;">Filename</label>
                                <span>The Shawshank Redemption 1994 1080p Bluray Remux DTS-HD MA 5.1 AVC-decatora27.mkv</span>
                                <br>

                                <label class="fw-bold" style="width: 9em;">Path</label>
                                <span>M:\Movies\Movies</span>
                                <br>

                                <label class="fw-bold" style="width: 9em;">Codec</label>
                                <span>H264</span>
                                <br>

                                <label class="fw-bold" style="width: 9em;">Edition</label>
                                <span>Anniversary Edition</span>
                                <br>

                                <label class="fw-bold" style="width: 9em;">Resolution</label>
                                <span>1080p</span>
                                <br>

                                <label class="fw-bold" style="width: 9em;">Sample</label>
                                <span>False</span>
                                <br>

                                <label class="fw-bold" style="width: 9em;">Source</label>
                                <span>BluRay</span>
                                <br>

                                <label class="fw-bold" style="width: 9em;">Title</label>
                                <span>The Shawshank Redemption</span>
                                <br>

                                <label class="fw-bold" style="width: 9em;">Year</label>
                                <span>1994</span>
                                <br>
                            </div>

                            <hr>

                            <div class="bg-dark p-2">
                                <h5 class="text-white">
                                    Scanned Data
                                </h5>

                                <label class="fw-bold" style="width: 9em;">Duration</label>
                                <span>02:20:18</span>
                                <br>

                                <label class="fw-bold" style="width: 9em;">Size</label>
                                <span>12.53 GB</span>
                                <br>

                                <label class="fw-bold" style="width: 9em;">Bitrate</label>
                                <span>12055 kbps</span>
                                <br>

                                <label class="fw-bold" style="width: 9em;">Video Codec</label>
                                <span>H264</span>
                                <br>

                                <label class="fw-bold" style="width: 9em;">Audio Codec</label>
                                <span>DTS HD-MA</span>
                                <br>
                            </div>

                            <hr>

                            <div>
                                <h5 class="text-white">Cast</h5>
                            </div>
                        </div>
                        <div class="col-auto">
                            <img alt="Backdrop" style="width: 30em;"
                                 src="{{ url_for("static", filename="iNh3BivHyg5sQRPP1KOkzguEX0H.jpg") }}">
                        </div>
                    </div>
                </div>

                <div class="card-footer">
                    <button class="btn btn-orange fw-bold">Play</button>
                    <button class="btn btn-outline-primary fw-bold">Fix Match</button>
                    <button class="btn btn-outline-primary fw-bold">Refresh Local Data</button>
                    <button class="btn btn-outline-primary fw-bold">Refresh Remote Data</button>
                    <button class="btn btn-danger text-dark fw-bold">Delete</button>

                    <span class="float-end text-white-50 pt-2" data-bs-toggle="tooltip" data-bs-placement="left"
                          title="Object Hash">bu3ib98r37ubiub</span>
                </div>
            </div>
        </div>
    </div>

{% endblock main_content %}

{% block extra_js %}
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            let tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
            let tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
                return new bootstrap.Tooltip(tooltipTriggerEl)
            })

            let table = document.querySelector("#movie_list");

            fetch("{{ url_for("movies.movies") }}", {
                method: "POST"
            })
                .then(response => response.json())
                .then(function (data) {
                    console.log(data);

                    document.querySelector("#sources_count").innerText = data["source_count"];
                    document.querySelector("#movie_count").innerText = data["movie_count"];

                    if (data["movie_count"] === 0)
                        table.querySelector("#body").insertAdjacentHTML("beforeend", `<tr><td colspan=4 class="text-center fst-italic">No results available</td></tr>`);

                    data["movies"].forEach(function (movie) {
                        table.querySelector("#body").insertAdjacentHTML("beforeend", `
                        <tr class="row-hover">
                            <td>
                                <img src="${'{{ url_for("static", filename="test.jpg") }}'.replace("test.jpg", movie["img_path"])}" alt="Poster" class="img">
                            </td>
                            <td class="text-justify">
                                <b>${movie["tmdb"]["title"]}</b>
                                <br>
                                <small class="text-white-50">${movie["tmdb"]["overview"]}</small>
                            </td>
                            <td><b>${movie["marked"]["year"]}</b></td>
                            <td>
                                <b>${movie["tmdb"]["vote_average"]}</b>
                                <small class="text-muted">${movie["tmdb"]["vote_count"]}</small>
                            </td>
                        </tr>
                        `)
                    })
                });
        });
    </script>
{% endblock extra_js %}